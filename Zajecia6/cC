#include <CUnit/Basic.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef enum {MON, TUE, WED, THU, FRI, SAT, SUN} Day;
typedef enum {DAY_EARLIER, DAY_LATER, TIME_EARLIER, TIME_LATER} Action;

int dl=0;

char* Day__toString(Day day){
  if(day==0)
    return "Poniedziałek";
  if(day==1)
    return "Wtorek";
  if(day==2)
    return "Środa";
  if(day==3)
    return "Czwartek";
  if(day==4)
    return "Piątek";
  if(day==5)
    return "Sobota";
  if(day==6)
    return "Niedziela";
}

Day Obsluga__Dni(char *s){
  if(!strcmp(s,"Mon"))
    return MON;
  if(!strcmp(s,"Tue"))
    return TUE;
  if(!strcmp(s,"Wed"))
    return WED;
  if(!strcmp(s,"Fri"))
    return FRI;
  if(!strcmp(s,"Sat"))
    return SAT;
  if(!strcmp(s,"Sun"))
    return SUN;
  if(!strcmp(s,"Thu"))
    return THU;
}

Day Day__nextDay(Day day){
  if(day==SUN)
    return MON;
  else
    return day+1;
}

Day Day__prevDay(Day day){
  if(day==MON)
    return SUN;
  else
    return day-1;
}

Day Day__swich(Action *actions, Day day) {
  for(int i=0; i<dl; i++)
    printf("%d\n", actions[i]);
  printf("\n");
  for(int i=0; i<dl; i++){
    switch (actions[i]){
     case DAY_EARLIER:
       day = Day__prevDay(day);
       break;
     case DAY_LATER:
       day = Day__nextDay(day);
       break;
    }
  }
  return day;
}

Action* parse(int rozmiarTablicy, char *tablica[]){
  int j=0;
  Action *zwrot = malloc(rozmiarTablicy * sizeof(*zwrot));
  for(int i=0; i<rozmiarTablicy-1; i++){
    if(!strcmp(tablica[i], "d-")){
      zwrot[j] = DAY_EARLIER;
      j++;
    }
    if(!strcmp(tablica[i], "d+")){
      zwrot[j] = DAY_LATER;
      j++;
    }
    if(!strcmp(tablica[i], "t-")){
      zwrot[j] = TIME_EARLIER;
      j++;
    }
    if(!strcmp(tablica[i], "t+")){
      zwrot[j] = TIME_LATER;
      j++;
    }
  }
  dl=j; //globalna dlugosc
  return zwrot;
}

//----------------------testy-------------------------------
void test_parse(){
  dl=5;
  char *arg[]={"d+", "d+", "t-", "t+", "d-"};
  Day dzin=Day__swich(parse(dl,arg), Obsluga__Dni("Mon"));
  printf("%d",dzin);
  dl=5;
  CU_ASSERT_EQUAL(Day__swich(parse(dl,arg), Obsluga__Dni("Mon")), TUE);
  arg[0]="d-";
  arg[1]="aa";
  arg[2]="d-";
  arg[3]="d+";
  arg[4]="d+";
  dl=5;
  CU_ASSERT_EQUAL(Day__swich(parse(dl,arg), Obsluga__Dni("Wed")), WED);
  arg[0]="d+";
  arg[1]="aa";
  arg[2]="d+";
  arg[3]="aa";
  arg[4]="t+";
  dl=5;
  CU_ASSERT_EQUAL(Day__swich(parse(dl,arg), Obsluga__Dni("Sat")), MON);
}

void testString(){
  CU_ASSERT_STRING_EQUAL(Day__toString(MON), "Poniedziałek");
  CU_ASSERT_STRING_EQUAL(Day__toString(TUE), "Wtorek");
  CU_ASSERT_STRING_EQUAL(Day__toString(WED), "Środa");
}

void testDayNext(){
  CU_ASSERT_EQUAL(WED, Day__nextDay(TUE));
  CU_ASSERT_EQUAL(MON, Day__nextDay(SUN));
}

void testDayPrev(){
  CU_ASSERT_EQUAL(WED, Day__prevDay(THU));
  CU_ASSERT_EQUAL(SUN, Day__prevDay(MON));
}

int main(){
  CU_pSuite pSuite = NULL;

  /* initialize the CUnit test registry */
  if (CUE_SUCCESS != CU_initialize_registry())
    return CU_get_error();

  /* add a suite to the registry */
  pSuite = CU_add_suite("Dni_tygodnia", 0,0);
  if (NULL == pSuite) {
    CU_cleanup_registry();
    return CU_get_error();
  }

  if ((NULL == CU_add_test(pSuite, "parsing", test_parse)))
    {
      CU_cleanup_registry();
      return CU_get_error();
    }
  if ((NULL == CU_add_test(pSuite, "test of day__prevDay", testDayPrev)))
      {
        CU_cleanup_registry();
        return CU_get_error();
        }
  if ((NULL == CU_add_test(pSuite, "test of day__toString", testString)))
        {
        CU_cleanup_registry();
        return CU_get_error();
        }

  if ((NULL == CU_add_test(pSuite,"test of day__nextDay", testDayNext)))
        {
        CU_cleanup_registry();
        return CU_get_error();
        }
  /* Run all tests using the CUnit Basic interface */
  CU_basic_set_mode(CU_BRM_VERBOSE);
  CU_basic_run_tests();
  CU_cleanup_registry();
  return CU_get_error();
}
